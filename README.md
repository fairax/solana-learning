# Сравнение Solana-программ и классического бэкенда

## Введение

В этом уроке вы узнаете, чем Solana-программа отличается от обычного серверного бэкенда: где выполняется код, как хранятся данные, кто выполняет ваши запросы и какие ограничения накладывает блокчейн.

## 1. Что такое Solana-программа?

Solana-программа — это код, загруженный в блокчейн Solana. Она обрабатывает транзакции и управляет данными, которые хранятся в аккаунтах блокчейна.

Чтобы понять, как она работает, нужно знать основы устройства Solana:

- **программы** — бинарный код, загруженный в блокчейн;
- **аккаунты** — хранилища данных;
- **валидаторы** — независимые участники, которые выполняют код программ.

Упрощённо можно считать, что валидатор — это сервер, который хранит у себя копию блокчейна. Валидаторы по очереди становятся лидерами. Лидер выполняет транзакции из очереди сколько успеет пока остаётся лидером, а остальные валидаторы повторяют их выполнение в том же порядке, чтобы сверить результаты. Далее статус лидера переходит другому валидатору, к этому моменту состояние блокчейна у всех должно быть одинаковым, и процесс повторяется.

Solana децентрализована: чтобы стать валидатором, не нужно чьего-то разрешения — достаточно соблюсти технические требования и внести депозит в нативной валюте SOL. Сейчас в сети работает более 800 валидаторов.

Именно из-за децентрализованной архитектуры Solana-программы сильно отличаются от классического бэкенда. Рассмотрим эти отличия по порядку.

## 2. Код программ

### В классическом бэкенде

Для разработки бэкенда существует множество фреймворков: Django (Python), Axum (Rust), стандартные библиотеки Go и C#. Код таких приложений обычно доступен только владельцу.

### В Solana

Solana-программы компилируются в байткод для среды исполнения Sealevel. Это необходимо, чтобы все валидаторы, выполняя один и тот же код, получали одинаковый результат.

Основной язык разработки — Rust. Также существует компилятор для C/C++ и экспериментальный для TypeScript.

Важно: **байткод Solana-программы всегда публичен**, так как он должен быть доступен каждому валидатору. Однако публиковать исходный код не требуется.

Пример Solana-программы:
```rust
use anchor_lang::prelude::*;

declare_id!("2phbC62wekpw95XuBk4i1KX4uA8zBUWmYbiTMhicSuBV");

#[program]
pub mod hello_solana {
    use super::*;

    pub fn hello(_ctx: Context<Hello>) -> Result<()> {
        msg!("Hello, Solana!");

        msg!("Our program's Program ID: {}", &id());

        Ok(())
    }
}

#[derive(Accounts)]
pub struct Hello {}
```

## 3. Сервер и деплой

### В классическом бэкенде

Нужен сервер, который владелец арендует и обслуживает. Он обрабатывает запросы и выполняет фоновые задачи.

### В Solana

Сервер не нужен — вычисления обеспечивают валидаторы.
Код выполняется только в рамках транзакции, фоновых задач нет.  
За каждую транзакцию взимается комиссия в SOL.

Чтобы задеплоить программу, нужно отправить ряд транзакций валидаторам через RPC-провайдера:

1. **Получить доступ к RPC-провайдеру.** Некоторые требуют регистрацию, но для разработки можно использовать `https://api.devnet.solana.com`, который доступен без создания аккаунта.

2. **Создать аккаунт Solana.** Это можно сделать в кошельке (например, Phantom) или через CLI-утилиту `solana-keygen new --outfile my-keypair.json`. Аккаунт — это пара ключей (приватный/публичный). Он создаётся локально, без взаимодействия с валидаторами и вообще сетью.

3. **Получить SOL.**  
   - В продакшене SOL покупают на биржах.
   - В Devnet SOL можно получить бесплатно через faucet.
     Например:
     `solana airdrop 2 <ПУБЛИЧНЫЙ_КЛЮЧ> --url https://api.devnet.solana.com`

4. **Отправить транзакции для деплоя.**
   Пример:
   `solana program deploy myprogram.so --keypair my-keypair.json --url https://api.devnet.solana.com`

## 4. Хранение данных

### В бэкенде

Данные хранятся в базе данных или файловой системе. Они недоступны пользователям напрямую.

### В Solana

Данные хранятся в **аккаунтах**. Каждый валидатор хранит их копию. Обычно каждому пользователю нужно создавать аккаунт для работы с каждой программой. Программа может менять данные аккаунта только в рамках транзакции, подписанной пользователем. Сам пользователь изменять данные напрямую не может.

И байткод программ, и содержимое аккаунтов — публичны, чтобы валидаторы могли их использовать при выполнении инструкций.

## 5. Выполнение запросов

### В бэкенде

Запросы чаще всего бесплатны (если нет подписок).

### В Solana

Запросы отправляются валидаторам через RPC-провайдера:

- **чтение** данных — бесплатно;
- **запись** данных — только через транзакцию, за которую взимается комиссия.

Если при выполнении программы произошла ошибка, комиссия всё равно списывается — валидатор уже затратил ресурсы. Комиссии защищают сеть от злоупотреблений и не позволяют устроить отказ в обслуживании (DoS) простым отправлением большого числа запросов. Они необходимы потому что в блокчейне нет других механизмов, позволяющих отказать злоумышленнику в их обработке.

## 6. Обработка ошибок

### В классическом бэкенде

Ошибки могут оставить данные в неконсистентном состоянии, поэтому требуются механизмы отката.

### В Solana

Валидаторы автоматически откатывают состояние, если транзакция завершилась ошибкой. Данные всегда либо обновляются полностью, либо не обновляются вовсе.

## 7. Цензура

### В бэкенде

Владелец сервера может ограничивать частоту запросов или блокировать пользователей.

### В Solana

RPC-провайдеры тоже могут накладывать ограничения, но пользователь может просто перейти на другого провайдера.

Когда транзакция попадает к валидаторам, полностью заблокировать её можно только при поддержке более чем двух третей всех валидаторов. Иначе её можно лишь задержать, пока лидером не станет валидатор, готовый её выполнить.

## 8. Финальность транзакций

### В бэкенде

Запрос считается выполненным, как только бэкенд вернул ответ.

### В Solana

Транзакция проходит три стадии:

1. **Обработана лидером (processed).**
2. **Подтверждена большинством валидаторов (confirmed).**
3. **Попала в корневой слот — стала финализированной (finalized).**

Только финализированная транзакция гарантированно необратима. Обычно финализация занимает 6–12 секунд.

## 9. Доступность

Бэкенд доступен, пока владелец поддерживает сервер: платит за хостинг, обновляет систему и т.п.

Solana-программа доступна, пока работает блокчейн. Стоимость хранения данных выше, чем на обычных серверах, так как данные должны храниться вечно и реплицироваться на всех валидаторах. Валидаторы продолжают получать комиссии, пока программой пользуются.